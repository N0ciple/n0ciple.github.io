<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#FFFFFF"><title>üêã Custom Docker image for Ethereum mining &#183; Robin Dupont</title><meta name=title content="üêã Custom Docker image for Ethereum mining &#183; Robin Dupont"><script type=text/javascript src=https://robin.dupont.onl/js/appearance.min.8a082f81b27f3cb2ee528df0b0bdc39787034cf2cc34d4669fbc9977c929023c.js integrity="sha256-iggvgbJ/PLLuUo3wsL3Dl4cDTPLMNNRmn7yZd8kpAjw="></script><link type=text/css rel=stylesheet href=https://robin.dupont.onl/css/main.bundle.min.31da017b00c1cf1a8d5888868a6dccfc21560bc672bef607de2cdf1615c9edef.css integrity="sha256-MdoBewDBzxqNWIiGim3M/CFWC8ZyvvYH3izfFhXJ7e8="><meta name=description content="
      
        
      
    "><link rel=canonical href=https://robin.dupont.onl/posts/ethereum-mining/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://robin.dupont.onl/posts/ethereum-mining/"><meta property="og:site_name" content="Robin Dupont"><meta property="og:title" content="üêã Custom Docker image for Ethereum mining"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-10-21T00:00:00+00:00"><meta property="article:modified_time" content="2021-10-21T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="üêã Custom Docker image for Ethereum mining"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","articleSection":"","name":"üêã Custom Docker image for Ethereum mining","headline":"üêã Custom Docker image for Ethereum mining","inLanguage":"en","url":"https:\/\/robin.dupont.onl\/posts\/ethereum-mining\/","author":{"@type":"Person","name":"Robin Dupont"},"copyrightYear":"2021","dateCreated":"2021-10-21T00:00:00\u002b00:00","datePublished":"2021-10-21T00:00:00\u002b00:00","dateModified":"2021-10-21T00:00:00\u002b00:00","mainEntityOfPage":"true","wordCount":"1823"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://robin.dupont.onl/","name":"","position":1},{"@type":"ListItem","item":"https://robin.dupont.onl/posts/","name":"","position":2},{"@type":"ListItem","name":"Custom Docker Image for Ethereum Mining","position":3}]}</script><meta name=author content="Robin Dupont"><link href=mailto:robin@dupont.cc rel=me><link href=https://github.com/n0ciple rel=me><link href=https://www.linkedin.com/in/robin-dupont/ rel=me><link href=https://mastodon.social/@rqjdupont rel=me><link href=https://twitter.com/rqjdupont rel=me><link href="https://scholar.google.com/citations?hl=fr&amp;user=c_xWMdUAAAAJ" rel=me><script async src="https://www.googletagmanager.com/gtag/js?id=G-BDM1DTDEWF"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-BDM1DTDEWF")}</script></head><body class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="py-6 font-semibold text-neutral-900 dark:text-neutral sm:py-10 print:hidden"><nav class="flex items-start justify-between sm:items-center"><div class="flex flex-row items-center"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>Robin Dupont</a></div><ul class="flex list-none flex-col text-end sm:flex-row"><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/posts/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Blog</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/about/ title="About me üîé"><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">About</span></a></li></ul></nav></header><div class="relative flex grow flex-col"><main id=main-content class=grow><article class=max-w-full><header><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">üêã Custom Docker image for Ethereum mining</h1></header><section class="prose mt-6 max-w-full dark:prose-invert"><h2 id=about-ethereum-and-ethereum-mining class="relative group">About Ethereum and Ethereum mining <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#about-ethereum-and-ethereum-mining aria-label=Anchor>#</a></span></h2><p><strong>Ethereum</strong> is the second most popular cryptocurrency by volume on the internet. One nice thing about it is that it has been conceived to be <strong>ASICs-proof</strong>. You can <em>in theory</em>, only mine ETH on a GPU or CPU. It is to say that you could help secure the blockchain and more importantly <strong>earn a bit of ETH</strong> from your computer. No need for an expensive and <strong>noisy ASIC miner</strong> !</p><p>If you want to mine cryptocurrency easily, you can use premade binaries (such as <a href=https://trex-miner.com/ target=_blank>T-Rex miner</a>
) or services (such as <a href=https://www.nicehash.com/ target=_blank>NiceHash</a>
). However, bear in mind that most of these binaries or services take <strong>a small fee</strong>, generally around <strong>1%</strong> of your hard-earned ETH. If you would rather keep this 1% for you or use <strong>open-source software</strong>, this is possible thanks to <a href=https://github.com/ethereum-mining/ethminer target=_blank>ethminer</a>
!</p><p>Ethminer is an open-source Ethereum miner written in C++ and compatible with both AMD (through OpenCL) and Nvidia (through CUDA) GPUs. The latest release of ethminer is from <strong>july 2019</strong>, and is built against CUDA 9 at best. With <strong>CUDA 9</strong> you <strong>will not</strong> be able to run ethminer on the <strong>most recent Nvidia cards</strong> (RTX 3000 series, for example, requires at least CUDA 11.1). Therefore you will need to <strong>build ethminer yourself</strong> if you want to use recent GPUs. This is far from impossible but a bit tedious since ethminer uses Hunter to fetch some dependencies. Hunter uses Bintray, which has been <a href=https://jfrog.com/blog/into-the-sunset-bintray-jcenter-gocenter-and-chartcenter/ target=_blank>sunseted</a>
on the 1rst of May 2021.</p><p>To keep this simple, the easiest way to use ethminer is to use a <strong>docker container</strong> that does all the hard work of building and running ethminer for you. If you just want to use the Docker image directly, jump to the <a href=#running>section</a>
about actually running ethminer. If you want some details about how to make the <strong>Dockerfile</strong> follow through the next section!</p><h2 id=requirements class="relative group">Requirements <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#requirements aria-label=Anchor>#</a></span></h2><p>For this project you will need to have :</p><ul><li>A Linux machine with at least one Nvidia GPU.</li><li>Docker. It can be installed on linux with <code>curl https://get.docker.com | sh</code></li><li>nvidia-docker. It can be installed on Debian based version of Linux with <code>sudo apt install nvidia-docker2</code></li><li>The Nvidia drivers. It can be installed on Ubuntu with <code>sudo apt install nvidia-headless-470-server</code> if it was not already installed.</li></ul><h2 id=creating-the-dockerfile class="relative group">Creating the Dockerfile <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#creating-the-dockerfile aria-label=Anchor>#</a></span></h2><p>First, let us create a directory to work in, I will call it <code>ethminer-docker</code>. In our folder, we will first create a script to launch ethminer. Create a file <code>mining.sh</code> and write the following script:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ethminer --HWMON <span class=m>2</span> <span class=se>\ </span> 
</span></span><span class=line><span class=cl>         -P <span class=nv>$MINING_ADDRESS</span> <span class=se>\ </span>
</span></span><span class=line><span class=cl>         --api-bind 0.0.0.0:3333
</span></span></code></pre></div><p><code>--HWMON 2</code> Enable hardware monitoring<br><code>-P $MINING_ADDRESS</code> Uses an environment variable to store the pool address + wallet<br><code>--api-bind 0.0.0.0:3333</code> Enable the API on port 3333. There is no need to change the port, since we can expose a different port to the host with Docker.</p><p>Your folder structure should now look like this:</p><pre tabindex=0><code>ethminer-docker
‚îî‚îÄ‚îÄ mining.sh
</code></pre><p>Now, in order to build our Docker container, we are going to write a file called <code>Dockerfile</code>. This file will contain all the instruction to create the docker image. The original instructions specific to ethminer can be found on the <a href=https://github.com/ethereum-mining/ethminer/blob/master/docs/BUILD.md target=_blank><code>docs/BUILD.md</code></a>
file of the ethermine repo.</p><p>In our Dockerfile, we first start by writing the following line that allows us to use a <strong>premade image from Nvidia</strong> containing the drivers as a <strong>base image</strong>, on top of which we will install the drivers. As you can see here, our docker image will have the driver version <code>460.73.01</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=w> </span><span class=s>nvidia/driver:460.73.01-ubuntu20.04</span><span class=err>
</span></span></span></code></pre></div><p>Then we update the sources and install the necessary dependencies to build ethminer.<br>The environment variable <code>DEBIAN_FRONTEND</code> is here to prevent <code>apt-get</code> from asking us questions since the installation process is supposed to be <strong>unattended</strong>. That is also why we add <code>-y</code> : to accept without further input from <code>apt-get</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=k>RUN</span> apt-get update <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=nv>DEBIAN_FRONTEND</span><span class=o>=</span>noninteractive apt-get install kmod git cmake perl gcc g++ wget --no-install-recommends -yq<span class=err>
</span></span></span></code></pre></div><p>We fetch the CUDA install script, run it and finaly delete it in the same <code>RUN</code> statement. This prevents the addition of a lot of useless layer in the creation of the docker image. Here we download CUDA version <code>11.4.2</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=k>RUN</span> wget --no-check-certificate https://developer.download.nvidia.com/compute/cuda/11.4.2/local_installers/cuda_11.4.2_470.57.02_linux.run <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    sh cuda_11.4.2_470.57.02_linux.run --silent --toolkit --no-man-page --no-opengl-libs <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    rm cuda_11.4.2_470.57.02_linux.run <span class=err>
</span></span></span></code></pre></div><p>We change our working directory to <code>/</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl>WORKDIR <span class=s2>&#34;/&#34;</span><span class=err>
</span></span></span></code></pre></div><p>This big one-liner is responsible for cloning, configuring, building ethminer and finaly removing the useless files. This command is quite a big chunk so I will explained it in details. I used a big one-liner once again to <strong>limit the number of layers generated</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=k>RUN</span> git clone https://github.com/ethereum-mining/ethminer.git -o ethminer <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=nb>cd</span> /ethminer <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    git submodule update --init --recursive <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    mkdir build <span class=o>&amp;&amp;</span> <span class=nb>cd</span> build <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=c1># Hack because bintray does not exists anymore</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=c1># see https://unix.stackexchange.com/questions/652841/boost-continually-fails-to-download-while-using-cmake-for-ethminer</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    sed -i <span class=s1>&#39;/hunter_config(Boost VERSION 1.66.0)/c\hunter_config(\n     Boost\n     VERSION 1.66.0_new_url\n     SHA1 f0b20d2d9f64041e8e7450600de0267244649766\n     URL https://boostorg.jfrog.io/artifactory/main/release/1.66.0/source/boost_1_66_0.tar.gz\ )&#39;</span> /ethminer/cmake/Hunter/config.cmake <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    cmake .. -DETHASHCL<span class=o>=</span>OFF -DAPICORE<span class=o>=</span>ON -DETHASHCUDA<span class=o>=</span>ON -DBINKERN<span class=o>=</span>OFF <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    cmake --build . <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    make install <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=nb>cd</span> / <span class=o>&amp;&amp;</span> rm -rf ethminer<span class=err>
</span></span></span></code></pre></div><p>In this command, we first clone the repo on a folder called <code>ethminer</code>. We then basically follow the building instruction from the ethminer repo. But before the configuring, we use a big <code>sed</code> command to edit the <strong>Hunter configuration</strong>. This is necessary since without this modification, Hunter is going to try to fetch Boost on Bintray and <strong>fail</strong>. Downloading manually Boost is not going to work either. The <strong>hash does not correspond</strong> to the one expected by Hunter, hence this modification with <code>sed</code>. More details <a href=https://unix.stackexchange.com/questions/652841/boost-continually-fails-to-download-while-using-cmake-for-ethminer target=_blank>here</a>
.<br>Once the modification of the Hunter <code>config.cmake</code> file is done, we generate the build configuration with 4 flags. <code>-DETHASHCL=OFF</code> <strong>disable OpenCL</strong>, since it is for AMD GPUs. However, ethminer can mine on both AMD and Nvidia GPUs at the same time. So if you want to mine Ethereum on such a hardware configuration, enable OpenCL with <code>-DETHASHCL=ON</code>. <code>-DAPICORE=ON</code> Enables the API (more details on that later). <code>-DETHASHCUDA=ON</code> makes sure <strong>CUDA support is enabled</strong>. And finally <code>-DBINKERN=OFF</code> prevent the installation of AMD binary kernels (once again, enable it if you want to use AMD GPUs).<br>Once this is done, we build ethminer, then install it (so that it is in our <code>$PATH</code>). and finally <strong>delete the repo directory</strong> as we do not need any of these files anymore.\</p><p>Now we <strong>expose port <code>3333</code></strong> (or any other port that you want to use, but make sure that this is the same port as the one in your <code>mining.sh</code> script) to access the API. The API is a <strong>simple web page</strong> with a few statistics such as the list of the GPUs, their temperature, fan speed and hash rate. This is helpful since we can <strong>easily access all these informations</strong> without having to look at the <strong>docker logs</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=k>EXPOSE</span><span class=w> </span><span class=s>3333</span><span class=err>
</span></span></span></code></pre></div><p>Example of the ethminer API :</p><p><figure><picture class="mx-auto my-0 rounded-md"><source srcset="https://robin.dupont.onl/posts/ethereum-mining/img/ethminer_api_example_hu_702978eec39e1e68.webp 330w,https://robin.dupont.onl/posts/ethereum-mining/img/ethminer_api_example_hu_19b0c65b76fd5982.webp 660w
,https://robin.dupont.onl/posts/ethereum-mining/img/ethminer_api_example_hu_262636863bfb647b.webp 842w
,https://robin.dupont.onl/posts/ethereum-mining/img/ethminer_api_example_hu_262636863bfb647b.webp 842w" sizes=100vw type=image/webp><img width=842 height=202 class="mx-auto my-0 rounded-md" alt="Example of ethminer API dashboard" loading=lazy decoding=async src=https://robin.dupont.onl/posts/ethereum-mining/img/ethminer_api_example_hu_e8884194a6af522f.png srcset="https://robin.dupont.onl/posts/ethereum-mining/img/ethminer_api_example_hu_4bbff51c60c91970.png 330w,https://robin.dupont.onl/posts/ethereum-mining/img/ethminer_api_example_hu_e8884194a6af522f.png 660w
,https://robin.dupont.onl/posts/ethereum-mining/img/ethminer_api_example.png 842w
,https://robin.dupont.onl/posts/ethereum-mining/img/ethminer_api_example.png 842w" sizes=100vw></picture><figcaption class=text-center>Example of ethminer API dashboard</figcaption></figure></p><p>We need to copy our mining script in the <code>/</code> directory of you docker image.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=k>COPY</span> mining.sh .<span class=err>
</span></span></span></code></pre></div><p>Finally, we have to <strong>overrive</strong> our base image entrypoint by adding a <strong>new one</strong> which will <strong>launch our mining script</strong>!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=k>ENTRYPOINT</span> <span class=p>[</span> <span class=s2>&#34;bash&#34;</span><span class=p>,</span> <span class=s2>&#34;mining.sh&#34;</span> <span class=p>]</span><span class=err>
</span></span></span></code></pre></div><p>The final Dockerfile is named <code>Dockerfile</code> (no extension) and contains the following :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=w> </span><span class=s>nvidia/driver:460.73.01-ubuntu20.04</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> apt-get update <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=nv>DEBIAN_FRONTEND</span><span class=o>=</span>noninteractive apt-get install kmod git cmake perl gcc g++ wget --no-install-recommends -yq<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> wget --no-check-certificate https://developer.download.nvidia.com/compute/cuda/11.4.2/local_installers/cuda_11.4.2_470.57.02_linux.run <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    sh cuda_11.4.2_470.57.02_linux.run --silent --toolkit --no-man-page --no-opengl-libs <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    rm cuda_11.4.2_470.57.02_linux.run <span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>WORKDIR <span class=s2>&#34;/&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> git clone https://github.com/ethereum-mining/ethminer.git -o ethminer <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=nb>cd</span> /ethminer <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    git submodule update --init --recursive <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    mkdir build <span class=o>&amp;&amp;</span> <span class=nb>cd</span> build <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    sed -i <span class=s1>&#39;/hunter_config(Boost VERSION 1.66.0)/c\hunter_config(\n     Boost\n     VERSION 1.66.0_new_url\n     SHA1 f0b20d2d9f64041e8e7450600de0267244649766\n     URL https://boostorg.jfrog.io/artifactory/main/release/1.66.0/source/boost_1_66_0.tar.gz\ )&#39;</span> /ethminer/cmake/Hunter/config.cmake <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    cmake .. -DETHASHCL<span class=o>=</span>OFF -DAPICORE<span class=o>=</span>ON -DETHASHCUDA<span class=o>=</span>ON -DBINKERN<span class=o>=</span>OFF <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    cmake --build . <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    make install <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=nb>cd</span> / <span class=o>&amp;&amp;</span> rm -rf ethminer<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=w> </span><span class=s>3333</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> mining.sh .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span> <span class=s2>&#34;bash&#34;</span><span class=p>,</span> <span class=s2>&#34;mining.sh&#34;</span> <span class=p>]</span><span class=err>
</span></span></span></code></pre></div><p>Your folder structure should now look like this:</p><pre tabindex=0><code>ethminer-docker
‚îú‚îÄ‚îÄ Dockerfile
‚îî‚îÄ‚îÄ mining.sh
</code></pre><h2 id=building-our-docker-image class="relative group">Building our Docker image <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#building-our-docker-image aria-label=Anchor>#</a></span></h2><p>Once we have our Dockerfile, this is a rather <strong>easy step</strong>. Assuming that you are in a directory containing only your Dockerfile, run</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker build -t ethminer .
</span></span></code></pre></div><p>‚ö†Ô∏è <em>Do not forget the dot at the end of the command (it means &ldquo;the current directory&rdquo;) !</em></p><p>You can change <code>ethermine</code> by what you want. It is the <strong>name of your docker image</strong>. You can confirm your docker image is on your system by running <code>docker image ls</code>. This should give something like this :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>REPOSITORY               TAG                     IMAGE ID       CREATED        SIZE
</span></span><span class=line><span class=cl>ethminer                 latest                  bcf676a57879   <span class=m>6</span> hours ago    7.15GB
</span></span></code></pre></div><h2 id=running-ethminer-on-docker class="relative group">Running ethminer on docker <a name=running></a><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#running-ethminer-on-docker aria-label=Anchor>#</a></span></h2><p>Before running ethminer, you need to <strong>install <code>nvidia-docker</code></strong>. This is a <strong>wrapper</strong> that allows docker to <strong>access your GPUs</strong> ! To install it, run :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt install nvidia-docker
</span></span></code></pre></div><p>Once this is done, you can run the container with :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -p &lt;port&gt;:3333 -d -e <span class=nv>MINING_ADDRESS</span><span class=o>=</span>&lt;your-mining-address&gt; --name my_ethminer 
</span></span></code></pre></div><p>‚ö†Ô∏è <em>Replace</em> <code>&lt;port></code> <em>by the port you want to use and</em> <code>&lt;your-mining-address></code> <em>by the address of the pool, combined with your wallet. You can find more info about how to write the mining address <a href=https://github.com/ethereum-mining/ethminer/blob/master/docs/POOL_EXAMPLES_ETH.md target=_blank>here</a></em></p><p>The <code>-p &lt;port>:3333</code> option allows to <strong>acces the ethminer API</strong> on port <code>&lt;port></code> of the machine you are currently running it on. If you are happy with port 3333, you can simply use <code>-p 3333</code> instead. <code>--name my_ethminer</code> gives a <strong>friendly name</strong> to your container. The <code>-d</code> makes the docker container run in <strong>detached mode</strong>. If you want to see the logs run :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker logs -f my_ethminer
</span></span></code></pre></div><p>You should see logs like this :</p><pre tabindex=0><code class=language-logs data-lang=logs>ethminer 0.19.0
Build: linux/release/gnu

 i 16:39:15 ethminer Configured pool &lt;pool-address&gt;
 i 16:39:15 ethminer Api server listening on port 3333.
 i 16:39:15 ethminer Selected pool &lt;pool-address&gt;
 i 16:39:15 ethminer Stratum mode : Eth-Proxy compatible
 i 16:39:15 ethminer Established connection to &lt;pool-address&gt; [&lt;pool-ip&gt;]
 i 16:39:15 ethminer Spinning up miners...
cu 16:39:15 cuda-0   Using Pci Id : 04:00.0 NVIDIA GeForce RTX 3070 (Compute 8.6) Memory : 7.65 GB
cu 16:39:15 cuda-1   Using Pci Id : 05:00.0 NVIDIA GeForce GTX 1060 6GB (Compute 6.1) Memory : 7.65 GB
 i 16:39:15 ethminer Epoch : 448 Difficulty : 4.29 Gh
 i 16:39:15 ethminer Job: deaebb22‚Ä¶ block 13468527 &lt;pool-address&gt; [&lt;pool-ip&gt;]
 i 16:39:17 ethminer Job: 0ca80852‚Ä¶ block 13468527 &lt;pool-address&gt; [&lt;pool-ip&gt;]
cu 16:39:17 cuda-1   Generating DAG + Light(on GPU) : 4.57 GB
cu 16:39:17 cuda-0   Generating DAG + Light(on GPU) : 4.57 GB
 i 16:39:17 ethminer New API session from &lt;your-local-ip+port&gt;
 i 16:39:17 ethminer New API session from &lt;your-local-ip+port&gt;
 i 16:39:19 ethminer Job: e0a946a7‚Ä¶ block 13468527 &lt;pool-address&gt; [&lt;pool-ip&gt;]
 m 16:39:20 ethminer 0:00 A0 0.00 h - cu0 0.00 62C 30% 188.24W, cu1 0.00 57C 49% 51.91W
</code></pre><p>If it is the case, <strong>congratulation</strong>! You are now mining Ethereum on your computer thanks to Docker! There was no need to install <code>kmod</code>, <code>git</code>, <code>cmake</code>, <code>perl</code>, etc&mldr; or even the CUDA Toolkit. Everything was done while building the docker image!</p><p>If you want to stop the container, simply run <code>docker stop my_ethminer</code> and <code>docker start my_ethminer</code> to start it back.</p></section><footer class=pt-8></footer></article></main><footer class="py-10 print:hidden"><div class="flex items-center justify-between"><div></div><div class="flex flex-row items-center"></div></div></footer></div></body></html>