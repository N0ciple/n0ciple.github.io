<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="no-cache,no-store,must-revalidate"/>
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />

<title>

  Robin  Dupont


  | üêã Custom Docker image for Ethereum mining

</title>
<meta name="description" content="Robin Dupont personal page
">

<!-- Open Graph -->


<!-- Bootstrap & MDB -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" integrity="sha512-RO38pBRxYH3SoOprtPTD86JFOclM51/XTIdEPh5j8sj4tp8jmQIx26twG52UaLi//hQldfrh7e51WzP9wuP32Q==" crossorigin="anonymous" />

<!-- Fonts & Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"  integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">


<!-- Styles -->

<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üë®‚Äçüåæ</text></svg>">

<link rel="stylesheet" href="/assets/css/main.css">
<link rel="canonical" href="/blog/2021/ethereum-mining-with-docker/">

<!-- JQuery -->
<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>


<!-- Theming-->

<script src="/assets/js/theme.js"></script>
<script src="/assets/js/dark_mode.js"></script>



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-99307127-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'UA-99307127-2');
</script>




    
<!-- MathJax -->
<script type="text/javascript">
  window.MathJax = {
    tex: {
      tags: 'ams'
    }
  };
</script>
<script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
<script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>


  </head>

  <body class="fixed-top-nav ">

    <!-- Header -->

    <header>

  <!-- Nav Bar -->
  <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
  <div class="container">
    
    <a class="navbar-brand title font-weight-lighter" href="/">
     <span class="font-weight-bold">Robin</span>   Dupont
    </a>
    
    <!-- Navbar Toggle -->
    <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar top-bar"></span>
      <span class="icon-bar middle-bar"></span>
      <span class="icon-bar bottom-bar"></span>
    </button>
    <div class="collapse navbar-collapse text-right" id="navbarNav">
      <ul class="navbar-nav ml-auto flex-nowrap">
        <!-- About -->
        <li class="nav-item ">
          <a class="nav-link" href="/">
            about
            
          </a>
        </li>
        
        <!-- Blog -->
        <li class="nav-item active">
          <a class="nav-link" href="/blog/">
            blog
            
          </a>
        </li>
        
        <!-- Other pages -->
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
          <div class = "toggle-container">
            <a id = "light-toggle">
                <i class="fas fa-moon"></i>
                <i class="fas fa-sun"></i>
            </a>
          </div>
        
      </ul>
    </div>
  </div>
</nav>

</header>


    <!-- Content -->

    <div class="container mt-5">
      

<div class="post">

  <header class="post-header">
    <h1 class="post-title">üêã Custom Docker image for Ethereum mining</h1>
    <p class="post-meta">October 21, 2021</p>
  </header>

  <article class="post-content">
    <h2 id="about-ethereum-and-ethereum-mining">About Ethereum and Ethereum mining</h2>

<p><strong>Ethereum</strong> is the second most popular cryptocurrency by volume on the internet. One nice thing about it is that it has been conceived to be <strong>ASICs-proof</strong>. You can <em>in theory</em>, only mine ETH on a GPU or CPU. It is to say that you could help secure the blockchain and more importantly <strong>earn a bit of ETH</strong> from your computer. No need for an expensive and <strong>noisy ASIC miner</strong> !</p>

<p>If you want to mine cryptocurrency easily, you can use premade binaries (such as <a href="https://trex-miner.com/">T-Rex miner</a>) or services (such as <a href="https://www.nicehash.com/">NiceHash</a>). However, bear in mind that most of these binaries or services take <strong>a small fee</strong>, generally around <strong>1%</strong> of your hard-earned ETH. If you would rather keep this 1% for you or use <strong>open-source software</strong>, this is possible thanks to <a href="https://github.com/ethereum-mining/ethminer">ethminer</a>!</p>

<p>Ethminer is an open-source Ethereum miner written in C++ and compatible with both AMD (through OpenCL) and Nvidia (through CUDA) GPUs. The latest release of ethminer is from <strong>july 2019</strong>, and is built against CUDA 9 at best. With <strong>CUDA 9</strong> you <strong>will not</strong> be able to run ethminer on the <strong>most recent Nvidia cards</strong> (RTX 3000 series, for example, requires at least CUDA 11.1). Therefore you will need to <strong>build ethminer yourself</strong> if you want to use recent GPUs. This is far from impossible but a bit tedious since ethminer uses Hunter to fetch some dependencies. Hunter uses Bintray, which has been <a href="https://jfrog.com/blog/into-the-sunset-bintray-jcenter-gocenter-and-chartcenter/">sunseted</a> on the 1rst of May 2021.</p>

<p>To keep this simple, the easiest way to use ethminer is to use a <strong>docker container</strong> that does all the hard work of building and running ethminer for you. If you just want to use the Docker image directly, jump to the <a href="#running">section</a> about actually running ethminer. If you want some details about how to make the <strong>Dockerfile</strong> follow through the next section!</p>

<h2 id="requirements">Requirements</h2>

<p>For this project you will need to have :</p>
<ul>
  <li>A Linux machine with at least one Nvidia GPU.</li>
  <li>Docker. It can be installed on linux with <code class="language-plaintext highlighter-rouge">curl https://get.docker.com | sh</code></li>
  <li>nvidia-docker. It can be installed on Debian based version of Linux with <code class="language-plaintext highlighter-rouge">sudo apt install nvidia-docker2</code></li>
  <li>The Nvidia drivers. It can be installed on Ubuntu with <code class="language-plaintext highlighter-rouge">sudo apt install nvidia-headless-470-server</code> if it was not already installed.</li>
</ul>

<h2 id="creating-the-dockerfile">Creating the Dockerfile</h2>

<p>First, let us create a directory to work in, I will call it <code class="language-plaintext highlighter-rouge">ethminer-docker</code>. In our folder, we will first create a script to launch ethminer. Create a file <code class="language-plaintext highlighter-rouge">mining.sh</code> and write the following script:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ethminer <span class="nt">--HWMON</span> 2 <span class="se">\ </span> 
         <span class="nt">-P</span> <span class="nv">$MINING_ADDRESS</span> <span class="se">\ </span>
         <span class="nt">--api-bind</span> 0.0.0.0:3333
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">--HWMON 2</code> Enable hardware monitoring <br />
<code class="language-plaintext highlighter-rouge">-P $MINING_ADDRESS</code> Uses an environment variable to store the pool address + wallet <br />
<code class="language-plaintext highlighter-rouge">--api-bind 0.0.0.0:3333</code> Enable the API on port 3333. There is no need to change the port, since we can expose a different port to the host with Docker.</p>

<p>Your folder structure should now look like this:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ethminer-docker
‚îî‚îÄ‚îÄ mining.sh
</code></pre></div></div>

<p>Now, in order to build our Docker container, we are going to write a file called <code class="language-plaintext highlighter-rouge">Dockerfile</code>. This file will contain all the instruction to create the docker image. The original instructions specific to ethminer can be found on the <a href="https://github.com/ethereum-mining/ethminer/blob/master/docs/BUILD.md"><code class="language-plaintext highlighter-rouge">docs/BUILD.md</code></a> file of the ethermine repo.</p>

<p>In our Dockerfile, we first start by writing the following line that allows us to use a <strong>premade image from Nvidia</strong> containing the drivers as a <strong>base image</strong>, on top of which we will install the drivers. As you can see here, our docker image will have the driver version <code class="language-plaintext highlighter-rouge">460.73.01</code>.</p>

<div class="language-Dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> nvidia/driver:460.73.01-ubuntu20.04</span>
</code></pre></div></div>
<p>Then we update the sources and install the necessary dependencies to build ethminer.<br />
The environment variable <code class="language-plaintext highlighter-rouge">DEBIAN_FRONTEND</code> is here to prevent <code class="language-plaintext highlighter-rouge">apt-get</code> from asking us questions since the installation process is supposed to be <strong>unattended</strong>. That is also why we add <code class="language-plaintext highlighter-rouge">-y</code> : to accept without further input from <code class="language-plaintext highlighter-rouge">apt-get</code></p>
<div class="language-Dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">RUN </span>apt-get update <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span>noninteractive apt-get <span class="nb">install </span>kmod git cmake perl gcc g++ wget <span class="nt">--no-install-recommends</span> <span class="nt">-yq</span>
</code></pre></div></div>

<p>We fetch the CUDA install script, run it and finaly delete it in the same <code class="language-plaintext highlighter-rouge">RUN</code> statement. This prevents the addition of a lot of useless layer in the creation of the docker image. Here we download CUDA version <code class="language-plaintext highlighter-rouge">11.4.2</code></p>
<div class="language-Dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">RUN </span>wget <span class="nt">--no-check-certificate</span> https://developer.download.nvidia.com/compute/cuda/11.4.2/local_installers/cuda_11.4.2_470.57.02_linux.run <span class="o">&amp;&amp;</span> <span class="se">\
</span>    sh cuda_11.4.2_470.57.02_linux.run <span class="nt">--silent</span> <span class="nt">--toolkit</span> <span class="nt">--no-man-page</span> <span class="nt">--no-opengl-libs</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">rm </span>cuda_11.4.2_470.57.02_linux.run 
</code></pre></div></div>
<p>We change our working directory to <code class="language-plaintext highlighter-rouge">/</code>.</p>
<div class="language-Dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">WORKDIR</span><span class="s"> "/"</span>
</code></pre></div></div>

<p>This big one-liner is responsible for cloning, configuring, building ethminer and finaly removing the useless files. This command is quite a big chunk so I will explained it in details. I used a big one-liner once again to <strong>limit the number of layers generated</strong>.</p>
<div class="language-Dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">RUN </span>git clone https://github.com/ethereum-mining/ethminer.git <span class="nt">-o</span> ethminer <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">cd</span> /ethminer <span class="o">&amp;&amp;</span> <span class="se">\
</span>    git submodule update <span class="nt">--init</span> <span class="nt">--recursive</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">mkdir </span>build <span class="o">&amp;&amp;</span> <span class="nb">cd </span>build <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="c"># Hack because bintray does not exists anymore</span>
    <span class="c"># see https://unix.stackexchange.com/questions/652841/boost-continually-fails-to-download-while-using-cmake-for-ethminer</span>
    sed -i '/hunter_config(Boost VERSION 1.66.0)/c\hunter_config(\n     Boost\n     VERSION 1.66.0_new_url\n     SHA1 f0b20d2d9f64041e8e7450600de0267244649766\n     URL https://boostorg.jfrog.io/artifactory/main/release/1.66.0/source/boost_1_66_0.tar.gz\ )' /ethminer/cmake/Hunter/config.cmake &amp;&amp; \
    cmake .. -DETHASHCL=OFF -DAPICORE=ON -DETHASHCUDA=ON -DBINKERN=OFF &amp;&amp; \
    cmake --build . &amp;&amp; \
    make install &amp;&amp; \
    cd / &amp;&amp; rm -rf ethminer
</code></pre></div></div>
<p>In this command, we first clone the repo on a folder called <code class="language-plaintext highlighter-rouge">ethminer</code>. We then basically follow the building instruction from the ethminer repo. But before the configuring, we use a big <code class="language-plaintext highlighter-rouge">sed</code> command to edit the <strong>Hunter configuration</strong>. This is necessary since without this modification, Hunter is going to try to fetch Boost on Bintray and <strong>fail</strong>. Downloading manually Boost is not going to work either. The <strong>hash does not correspond</strong> to the one expected by Hunter, hence this modification with <code class="language-plaintext highlighter-rouge">sed</code>. More details <a href="https://unix.stackexchange.com/questions/652841/boost-continually-fails-to-download-while-using-cmake-for-ethminer">here</a>.<br />
Once the modification of the Hunter <code class="language-plaintext highlighter-rouge">config.cmake</code> file is done, we generate the build configuration with 4 flags. <code class="language-plaintext highlighter-rouge">-DETHASHCL=OFF</code> <strong>disable OpenCL</strong>, since it is for AMD GPUs. However, ethminer can mine on both AMD and Nvidia GPUs at the same time. So if you want to mine Ethereum on such a hardware configuration, enable OpenCL with <code class="language-plaintext highlighter-rouge">-DETHASHCL=ON</code>. <code class="language-plaintext highlighter-rouge">-DAPICORE=ON</code> Enables the API (more details on that later). <code class="language-plaintext highlighter-rouge">-DETHASHCUDA=ON</code> makes sure <strong>CUDA support is enabled</strong>. And finally <code class="language-plaintext highlighter-rouge">-DBINKERN=OFF</code> prevent the installation of AMD binary kernels (once again, enable it if you want to use AMD GPUs).<br />
Once this is done, we build ethminer, then install it (so that it is in our <code class="language-plaintext highlighter-rouge">$PATH</code>). and finally <strong>delete the repo directory</strong> as we do not need any of these files anymore.\</p>

<p>Now we <strong>expose port <code class="language-plaintext highlighter-rouge">3333</code></strong> (or any other port that you want to use, but make sure that this is the same port as the one in your <code class="language-plaintext highlighter-rouge">mining.sh</code> script) to access the API. The API is a <strong>simple web page</strong> with a few statistics such as the list of the GPUs, their temperature, fan speed and hash rate. This is helpful since we can <strong>easily access all these informations</strong> without having to look at the <strong>docker logs</strong>.</p>
<div class="language-Dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">EXPOSE</span><span class="s"> 3333</span>
</code></pre></div></div>
<p>Example of the ethminer API :</p>

<figure>

  <picture>
    <!-- Fallback to the original file -->
    <img class="img-fluid rounded z-depth-1" src="/assets/img/blog/ethminer_api_example.png" title="Example of ethminer API" data-zoomable="" />

  </picture><figcaption class="caption">Example of ethminer API dashboard.</figcaption>

</figure>

<p>We need to copy our mining script in the <code class="language-plaintext highlighter-rouge">/</code> directory of you docker image.</p>
<div class="language-Dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">COPY</span><span class="s"> mining.sh .</span>
</code></pre></div></div>

<p>Finally, we have to <strong>overrive</strong> our base image entrypoint by adding a <strong>new one</strong>  which will <strong>launch our mining script</strong>!</p>
<div class="language-Dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ENTRYPOINT</span><span class="s"> [ "bash", "mining.sh" ]</span>
</code></pre></div></div>

<p>The final Dockerfile is named <code class="language-plaintext highlighter-rouge">Dockerfile</code> (no extension) and contains the following :</p>
<div class="language-Dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> nvidia/driver:460.73.01-ubuntu20.04</span>

<span class="k">RUN </span>apt-get update <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span>noninteractive apt-get <span class="nb">install </span>kmod git cmake perl gcc g++ wget <span class="nt">--no-install-recommends</span> <span class="nt">-yq</span>

<span class="k">RUN </span>wget <span class="nt">--no-check-certificate</span> https://developer.download.nvidia.com/compute/cuda/11.4.2/local_installers/cuda_11.4.2_470.57.02_linux.run <span class="o">&amp;&amp;</span> <span class="se">\
</span>    sh cuda_11.4.2_470.57.02_linux.run <span class="nt">--silent</span> <span class="nt">--toolkit</span> <span class="nt">--no-man-page</span> <span class="nt">--no-opengl-libs</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">rm </span>cuda_11.4.2_470.57.02_linux.run 

<span class="k">WORKDIR</span><span class="s"> "/"</span>

<span class="k">RUN </span>git clone https://github.com/ethereum-mining/ethminer.git <span class="nt">-o</span> ethminer <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">cd</span> /ethminer <span class="o">&amp;&amp;</span> <span class="se">\
</span>    git submodule update <span class="nt">--init</span> <span class="nt">--recursive</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">mkdir </span>build <span class="o">&amp;&amp;</span> <span class="nb">cd </span>build <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'/hunter_config(Boost VERSION 1.66.0)/c\hunter_config(\n     Boost\n     VERSION 1.66.0_new_url\n     SHA1 f0b20d2d9f64041e8e7450600de0267244649766\n     URL https://boostorg.jfrog.io/artifactory/main/release/1.66.0/source/boost_1_66_0.tar.gz\ )'</span> /ethminer/cmake/Hunter/config.cmake <span class="o">&amp;&amp;</span> <span class="se">\
</span>    cmake .. <span class="nt">-DETHASHCL</span><span class="o">=</span>OFF <span class="nt">-DAPICORE</span><span class="o">=</span>ON <span class="nt">-DETHASHCUDA</span><span class="o">=</span>ON <span class="nt">-DBINKERN</span><span class="o">=</span>OFF <span class="o">&amp;&amp;</span> <span class="se">\
</span>    cmake <span class="nt">--build</span> <span class="nb">.</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span>    make <span class="nb">install</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">cd</span> / <span class="o">&amp;&amp;</span> <span class="nb">rm</span> <span class="nt">-rf</span> ethminer

<span class="k">EXPOSE</span><span class="s"> 3333</span>

<span class="k">COPY</span><span class="s"> mining.sh .</span>

<span class="k">ENTRYPOINT</span><span class="s"> [ "bash", "mining.sh" ]</span>
</code></pre></div></div>

<p>Your folder structure should now look like this:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ethminer-docker
‚îú‚îÄ‚îÄ Dockerfile
‚îî‚îÄ‚îÄ mining.sh
</code></pre></div></div>

<h2 id="building-our-docker-image">Building our Docker image</h2>

<p>Once we have our Dockerfile, this is a rather <strong>easy step</strong>. Assuming that you are in a directory containing only your Dockerfile, run</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-t</span> ethminer <span class="nb">.</span>
</code></pre></div></div>
<p>‚ö†Ô∏è <em>Do not forget the dot at the end of the command (it means ‚Äúthe current directory‚Äù) !</em></p>

<p>You can change <code class="language-plaintext highlighter-rouge">ethermine</code> by what you want. It is the <strong>name of your docker image</strong>. You can confirm your docker image is on your system by running <code class="language-plaintext highlighter-rouge">docker image ls</code>. This should give something like this :</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>REPOSITORY               TAG                     IMAGE ID       CREATED        SIZE
ethminer                 latest                  bcf676a57879   6 hours ago    7.15GB
</code></pre></div></div>

<h2 id="running-ethminer-on-docker-">Running ethminer on docker <a name="running"></a></h2>

<p>Before running ethminer, you need to <strong>install <code class="language-plaintext highlighter-rouge">nvidia-docker</code></strong>. This is a <strong>wrapper</strong> that allows docker to <strong>access your GPUs</strong> ! To install it, run :</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>nvidia-docker
</code></pre></div></div>
<p>Once this is done, you can run the container with :</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-p</span> &lt;port&gt;:3333 <span class="nt">-d</span> <span class="nt">-e</span> <span class="nv">MINING_ADDRESS</span><span class="o">=</span>&lt;your-mining-address&gt; <span class="nt">--name</span> my_ethminer 
</code></pre></div></div>
<p>‚ö†Ô∏è <em>Replace</em> <code class="language-plaintext highlighter-rouge">&lt;port&gt;</code> <em>by the port you want to use and</em> <code class="language-plaintext highlighter-rouge">&lt;your-mining-address&gt;</code> <em>by the address of the pool, combined with your wallet. You can find more info about how to write the mining address <a href="https://github.com/ethereum-mining/ethminer/blob/master/docs/POOL_EXAMPLES_ETH.md">here</a></em></p>

<p>The <code class="language-plaintext highlighter-rouge">-p &lt;port&gt;:3333</code> option allows to <strong>acces the ethminer API</strong> on port <code class="language-plaintext highlighter-rouge">&lt;port&gt;</code> of the machine you are currently running it on. If you are happy with port 3333, you can simply use <code class="language-plaintext highlighter-rouge">-p 3333</code> instead. <code class="language-plaintext highlighter-rouge">--name my_ethminer</code> gives a <strong>friendly name</strong> to your container. The <code class="language-plaintext highlighter-rouge">-d</code> makes the docker container run in <strong>detached mode</strong>. If you want to see the logs run :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker logs <span class="nt">-f</span> my_ethminer
</code></pre></div></div>

<p>You should see logs like this :</p>
<pre><code class="language-logs">ethminer 0.19.0
Build: linux/release/gnu

 i 16:39:15 ethminer Configured pool &lt;pool-address&gt;
 i 16:39:15 ethminer Api server listening on port 3333.
 i 16:39:15 ethminer Selected pool &lt;pool-address&gt;
 i 16:39:15 ethminer Stratum mode : Eth-Proxy compatible
 i 16:39:15 ethminer Established connection to &lt;pool-address&gt; [&lt;pool-ip&gt;]
 i 16:39:15 ethminer Spinning up miners...
cu 16:39:15 cuda-0   Using Pci Id : 04:00.0 NVIDIA GeForce RTX 3070 (Compute 8.6) Memory : 7.65 GB
cu 16:39:15 cuda-1   Using Pci Id : 05:00.0 NVIDIA GeForce GTX 1060 6GB (Compute 6.1) Memory : 7.65 GB
 i 16:39:15 ethminer Epoch : 448 Difficulty : 4.29 Gh
 i 16:39:15 ethminer Job: deaebb22‚Ä¶ block 13468527 &lt;pool-address&gt; [&lt;pool-ip&gt;]
 i 16:39:17 ethminer Job: 0ca80852‚Ä¶ block 13468527 &lt;pool-address&gt; [&lt;pool-ip&gt;]
cu 16:39:17 cuda-1   Generating DAG + Light(on GPU) : 4.57 GB
cu 16:39:17 cuda-0   Generating DAG + Light(on GPU) : 4.57 GB
 i 16:39:17 ethminer New API session from &lt;your-local-ip+port&gt;
 i 16:39:17 ethminer New API session from &lt;your-local-ip+port&gt;
 i 16:39:19 ethminer Job: e0a946a7‚Ä¶ block 13468527 &lt;pool-address&gt; [&lt;pool-ip&gt;]
 m 16:39:20 ethminer 0:00 A0 0.00 h - cu0 0.00 62C 30% 188.24W, cu1 0.00 57C 49% 51.91W
</code></pre>

<p>If it is the case, <strong>congratulation</strong>! You are now mining Ethereum on your computer thanks to Docker! There was no need to install <code class="language-plaintext highlighter-rouge">kmod</code>, <code class="language-plaintext highlighter-rouge">git</code>, <code class="language-plaintext highlighter-rouge">cmake</code>, <code class="language-plaintext highlighter-rouge">perl</code>, etc‚Ä¶ or even the CUDA Toolkit. Everything was done while building the docker image!</p>

<p>If you want to stop the container, simply run <code class="language-plaintext highlighter-rouge">docker stop my_ethminer</code> and <code class="language-plaintext highlighter-rouge">docker start my_ethminer</code> to start it back.</p>

  </article>

  
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname  = 'rd-blog';
      var disqus_identifier = '/blog/2021/ethereum-mining-with-docker';
      var disqus_title      = "üêã Custom Docker image for Ethereum mining";
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  

</div>

    </div>

    <!-- Footer -->

    
<footer class="fixed-bottom">
  <div class="container mt-0">

   2022 Robin  Dupont.
    Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio">al-folio</a> theme.

    
    

  </div>
</footer>



  </body>

  <!-- Bootsrap & MDB scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.4/umd/popper.min.js" integrity="sha512-eUQ9hGdLjBjY3F41CScH3UX+4JDSI9zXeroz7hJ+RteoCaY+GP/LDoM8AO+Pt+DRFw3nXqsjh9Zsts8hnYv8/A==" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha512-M5KW3ztuIICmVIhjSqXe01oV2bpe248gOxqmlcYrEzAvws7Pw3z6BK0iGbrwvdrUQUhi3eXgtxp5I8PDo9YfjQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js" integrity="sha512-Mug9KHKmroQFMLm93zGrjhibM2z2Obg9l6qFG2qKjXEXkMp/VDkI4uju9m4QKPjWSwQ6O2qzZEnJDEeCw0Blcw==" crossorigin="anonymous"></script>

  
<!-- Mansory & imagesLoaded -->
<script defer src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script defer src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
<script defer src="/assets/js/mansory.js" type="text/javascript"></script>


  


<!-- Medium Zoom JS -->
<script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
<script src="/assets/js/zoom.js"></script>


<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>


</html>
